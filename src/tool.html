<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>OneDocs - 文档智析</title>
        <link rel="stylesheet" href="css/style.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <!-- Font Awesome 本地引用 -->
        <link rel="stylesheet" href="fonts/fontawesome.min.css" />
        <!-- PDF.js库 -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
        <!-- Mammoth.js库用于Word文档 -->
        <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
        <!-- JSZip库用于PowerPoint文档 -->
        <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
        <!-- Marked.js用于Markdown解析 -->
        <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
        <!-- KaTeX用于LaTeX数学公式 -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"
        />
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
        <!-- 预加载提示词配置 -->
        <script src="prompts/science.js"></script>
        <script src="prompts/liberal.js"></script>
        <script src="prompts/data.js"></script>
        <script src="prompts/news.js"></script>
    </head>
    <body>
        <div class="tool-container">
            <header class="tool-header">
                <div class="header-left">
                    <button class="back-button" onclick="goBack()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1 class="tool-title">OneDocs</h1>
                </div>
                <div class="header-right">
                    <button
                        class="analyze-button-mini"
                        id="analyzeButtonMini"
                        onclick="analyzeDocument()"
                        disabled
                    >
                        <span class="button-text">开始析文</span>
                        <div class="button-loader" style="display: none"></div>
                    </button>
                    <button class="settings-button" onclick="openSettings()">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </header>

            <main class="tool-main">
                <!-- 侧边栏 -->
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <span class="sidebar-title">功能选择</span>
                        <button
                            class="collapse-btn"
                            id="collapseBtn"
                            onclick="toggleSidebar()"
                        >
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                    <div class="sidebar-content">
                        <div class="function-buttons">
                            <button
                                class="function-btn"
                                data-function="news"
                                onclick="selectFunction('news')"
                            >
                                <div class="function-icon">📰</div>
                                <div class="function-content">
                                    <div class="function-name">要闻概览</div>
                                    <div class="function-desc">
                                        新闻要点梳理
                                    </div>
                                </div>
                            </button>
                            <button
                                class="function-btn"
                                data-function="data"
                                onclick="selectFunction('data')"
                            >
                                <div class="function-icon">📊</div>
                                <div class="function-content">
                                    <div class="function-name">罗森析数</div>
                                    <div class="function-desc">
                                        数据内容分析
                                    </div>
                                </div>
                            </button>
                            <button
                                class="function-btn active"
                                data-function="science"
                                onclick="selectFunction('science')"
                            >
                                <div class="function-icon">🔬</div>
                                <div class="function-content">
                                    <div class="function-name">理工速知</div>
                                    <div class="function-desc">
                                        理工课件整理
                                    </div>
                                </div>
                            </button>
                            <button
                                class="function-btn"
                                data-function="liberal"
                                onclick="selectFunction('liberal')"
                            >
                                <div class="function-icon">📚</div>
                                <div class="function-content">
                                    <div class="function-name">文采丰呈</div>
                                    <div class="function-desc">
                                        文科课件整理
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 主内容区 -->
                <div class="main-content">
                    <div class="chat-container">
                        <div class="upload-section">
                            <div class="format-notice" id="formatNotice">
                                <p>
                                    <strong>📋 格式说明：</strong>支持
                                    <code>.pdf</code
                                    >、<code>.docx</code>、<code>.doc</code>、<code>.pptx</code>、<code>.ppt</code>、<code
                                        >.txt</code
                                    >
                                    格式文件
                                </p>
                                <button
                                    class="notice-close"
                                    onclick="closeFormatNotice()"
                                >
                                    ×
                                </button>
                            </div>
                            <div class="upload-area" id="uploadArea">
                                <div class="upload-content">
                                    <div class="upload-icon">📁</div>
                                    <p class="upload-text">点击选择文档</p>
                                    <p class="upload-hint">
                                        支持 PDF、Word、PowerPoint、TXT 格式
                                    </p>
                                    <input
                                        type="file"
                                        id="fileInput"
                                        accept=".pdf,.doc,.docx,.ppt,.pptx,.txt"
                                        style="display: none"
                                    />
                                </div>
                                <div
                                    class="file-preview"
                                    id="filePreview"
                                    style="display: none"
                                >
                                    <div class="file-info">
                                        <span
                                            class="file-name"
                                            id="fileName"
                                        ></span>
                                        <button
                                            class="remove-file"
                                            onclick="removeFile()"
                                        >
                                            ×
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 渲染提示文字 -->
                        <div class="render-notice">
                            <p>渲染结果仅供预览，请复制到外部文档整理查看</p>
                        </div>

                        <!-- 分析进度条 -->
                        <div
                            class="progress-section"
                            id="progressSection"
                            style="display: none"
                        >
                            <div class="progress-header">
                                <h3>正在分析文档...</h3>
                                <p class="progress-text" id="progressText">
                                    准备中...
                                </p>
                            </div>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div
                                        class="progress-fill"
                                        id="progressFill"
                                    ></div>
                                </div>
                                <span
                                    class="progress-percentage"
                                    id="progressPercentage"
                                    >0%</span
                                >
                            </div>
                        </div>

                        <div
                            class="result-section"
                            id="resultSection"
                            style="display: none"
                        >
                            <div class="result-header">
                                <h3 class="result-title">析文成果</h3>
                                <div class="result-controls">
                                    <div class="view-toggle">
                                        <button
                                            class="toggle-btn active"
                                            id="renderView"
                                            onclick="switchView('render')"
                                        >
                                            渲染视图
                                        </button>
                                        <button
                                            class="toggle-btn"
                                            id="markdownView"
                                            onclick="switchView('markdown')"
                                        >
                                            源码视图
                                        </button>
                                    </div>
                                    <button
                                        class="copy-button"
                                        onclick="copyResult()"
                                    >
                                        复制Markdown
                                    </button>
                                    <button
                                        class="copy-button"
                                        onclick="exportToPdf()"
                                    >
                                        导出
                                    </button>
                                </div>
                            </div>
                            <div class="result-body">
                                <div
                                    class="result-content"
                                    id="resultContent"
                                ></div>
                                <div
                                    class="result-markdown"
                                    id="resultMarkdown"
                                    style="display: none"
                                ></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal" style="display: none">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>设置配置</h3>
                    <button class="modal-close" onclick="closeSettings()">
                        ×
                    </button>
                </div>
                <div class="modal-body">
                    <div class="setting-item">
                        <label for="providerSelect">模型库选择</label>
                        <select
                            id="providerSelect"
                            onchange="onProviderChange()"
                        >
                            <option value="openai" selected>OpenAI</option>
                            <option value="deepseek">DeepSeek</option>
                            <option value="glm">智谱GLM</option>
                        </select>
                        <small>选择您要使用的AI模型提供商</small>
                    </div>
                    <div class="setting-item">
                        <label for="baseUrl">API Base URL</label>
                        <input
                            type="text"
                            id="baseUrl"
                            placeholder="https://api.openai.com/v1"
                        />
                        <small id="baseUrlHint"
                            >API服务器地址，默认为OpenAI官方地址</small
                        >
                    </div>
                    <div class="setting-item">
                        <label for="apiKey" id="apiKeyLabel">API Key</label>
                        <input
                            type="password"
                            id="apiKey"
                            placeholder="输入你的API密钥"
                        />
                        <small id="apiKeyHint"
                            >需要填入有效的API密钥方可使用</small
                        >
                    </div>
                    <div class="setting-item">
                        <label for="modelSelect">选择模型</label>
                        <select id="modelSelect">
                            <option value="gpt-4o" selected>GPT-4o</option>
                            <option value="gpt-4o-mini">GPT-4o-mini</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        </select>
                        <small id="modelHint"
                            >根据您的需求选择合适的AI模型</small
                        >
                    </div>
                </div>
                <div class="modal-footer">
                    <button
                        class="btn btn-test"
                        id="testConnectionBtn"
                        onclick="testConnection()"
                    >
                        🔗 测试连接
                    </button>
                    <div class="footer-right">
                        <button
                            class="btn btn-secondary"
                            onclick="closeSettings()"
                        >
                            取消
                        </button>
                        <button
                            class="btn btn-primary"
                            onclick="saveSettings()"
                        >
                            保存
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast" style="display: none">
            <span id="toastMessage"></span>
        </div>

        <script src="js/tool.js"></script>
    </body>
</html>
